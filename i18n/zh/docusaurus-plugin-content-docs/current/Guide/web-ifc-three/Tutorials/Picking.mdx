---
title: ğŸ¤ æ‹£é€‰
sidebar_position: 1
---

import { IfcCard } from "../../../../../../../src/components/Card/InfoCard";
import { IfcAlert } from "../../../../../../../src/components/Alert/Alert";
import { Scene } from "../../../../../../../src/components/Scene/Scene";

## ç®€ä»‹

ğŸš¶â€â™€ï¸
åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªæŠŠ IFC æ¨¡å‹åŠ è½½åˆ°åœºæ™¯ä¸­ã€‚è¿™å·²ç»å¾ˆä¸é”™äº†ï¼Œä½†å¦‚æœèƒ½å¤Ÿä¸è¯¥æ¨¡å‹è¿›è¡Œäº¤äº’å°±æ›´å¥½äº†ï¼Œè€Œè¿™æ­£æ˜¯æˆ‘ä»¬è¦åšçš„ã€‚

### å¯¼å…¥ Three.js çš„ä¾èµ–æ€§

âš¡âš¡âš¡
åœ¨ä½ èƒ½å¯¹ç‰©ä½“è¿›è¡Œæ“ä½œä¹‹å‰ï¼Œä½ éœ€è¦èƒ½å¤Ÿé€‰æ‹©å®ƒä»¬ã€‚è¿™å¯ä»¥é€šè¿‡[Three.js Raycaster](https://threejs.org/docs/#api/en/core/Raycaster)è½»æ¾å®ç°ï¼Œå®ƒå¯ä»¥ä»`three`çš„æ ¸å¿ƒåº“å¯¼å…¥ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å°†å¯¼å…¥ä¸€ä¸ª[Vector2](https://threejs.org/docs/#api/en/math/Vector2)å¯¹è±¡æ¥å­˜å‚¨é¼ æ ‡åœ¨åœºæ™¯ä¸­çš„ä½ç½®ã€‚

```js
import { Raycaster, Vector2 } from "three";
```

<IfcAlert>
  THREE.Raycasterå…è®¸ä½ å‘å°„ "å…‰æŸ"ï¼Œå‡»ä¸­åœºæ™¯ä¸­çš„ç‰©ä½“å¹¶è¿”å›å…¶ä¿¡æ¯ã€‚
</IfcAlert>

### å¯¼å…¥ tree-mesh-bvhï¼ˆå¯é€‰ï¼‰ã€‚

ğŸ‘©â€ğŸš€ğŸš€
æ­¤å¤–ï¼Œæˆ‘ä»¬å°†å¯¼å…¥[three-mesh-bvh åº“](https://github.com/gkjohnson/three-mesh-bvh)ï¼Œä½¿å¯¹è±¡çš„é€‰æ‹©æ›´åŠ ä¼˜åŒ–ã€‚è¿™å¯ä»¥ç”¨`npm i three-mesh-bvh`æ¥å®‰è£…ã€‚åˆ«æ‹…å¿ƒï¼Œä½ ä¸éœ€è¦å­¦ä¹ å¦‚ä½•ä½¿ç”¨è¿™ä¸ªåº“ã€‚åªè¦ç»™æˆ‘ä»¬è¿™äº›åº“çš„å¯¹è±¡ï¼ŒIFC.js ä¼šå¤„ç†å‰©ä¸‹çš„äº‹æƒ…ã€‚

```js
import {
  acceleratedRaycast,
  computeBoundsTree,
  disposeBoundsTree,
} from "three-mesh-bvh";

// Sets up optimized picking
ifcLoader.ifcManager.setupThreeMeshBVH(
  computeBoundsTree,
  disposeBoundsTree,
  acceleratedRaycast
);
```

### å­˜å‚¨ IFC æ¨¡å‹çš„å‚è€ƒ

ğŸ ğŸ ğŸ 
åœ¨åšå…¶ä»–äº‹æƒ…ä¹‹å‰ï¼Œæœ‰å¿…è¦åœ¨åœºæ™¯ä¸­ä¿å­˜ä¸€ä¸ªå¯¹ IFC æ¨¡å‹çš„å¼•ç”¨ï¼Œä»¥ä¾¿é€‰æ‹©å®ƒä»¬ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œåœ¨å…¶ä¸­å­˜å‚¨æˆ‘ä»¬åŠ è½½çš„æ¨¡å‹ã€‚

```js {2,6}
//Sets up the IFC loading
const ifcModels = [];
const ifcLoader = new IFCLoader();
ifcLoader.ifcManager.setWasmPath("../../");
async function loadIFC() {
  await ifcLoader.ifcManager.setWasmPath("../../");
  ifcLoader.load("../../IFC/01.ifc", (ifcModel) => {
    ifcModels.push(ifcModel);
    scene.add(ifcModel);
  });
}

loadIFC();
```

## å¦‚ä½•åš

ğŸ
æ¥ä¸‹æ¥æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª Raycaster çš„å®ä¾‹å’Œé¼ æ ‡ä½ç½®çŸ¢é‡ã€‚ä¸ºäº†ä¼˜åŒ–åº”ç”¨ç¨‹åºï¼ŒRaycaster å°†åªä»å®ƒé‡åˆ°çš„ç¬¬ä¸€ä¸ªå¯¹è±¡ä¸­è·å–ä¿¡æ¯ã€‚

```js
const raycaster = new Raycaster();
raycaster.firstHitOnly = true;
const mouse = new Vector2();
```

ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‡½æ•°æ¥è®© Raycaster æŠ•å°„å°„çº¿ï¼Œè®¡ç®—é¼ æ ‡åœ¨å±å¹•ä¸Šçš„ä½ç½®ã€‚è¯·æ³¨æ„ã€‚

- threeCanvas å¯¹è±¡æ˜¯æ¸²æŸ“ Three.js åœºæ™¯çš„ HTML`<canvas>`å…ƒç´ ã€‚å¯ä»¥ç”¨`getElementByID()`æ£€ç´¢åˆ°å®ƒçš„å¼•ç”¨ã€‚

- æœ‰å¿…è¦æŒ‡å®šå…‰æŸä¸å“ªäº›ç‰©ä½“ç¢°æ’ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒåªä¼šä¸åŠ è½½çš„ IFC æ¨¡å‹ç›¸æ’ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœºæ™¯ä¸­æœ‰æ›´å¤šçš„ç‰©ä½“ï¼Œå®ƒå°†å¿½ç•¥å®ƒä»¬ã€‚

```js
function cast(event) {
  // è®¡ç®—é¼ æ ‡åœ¨å±å¹•ä¸Šçš„ä½ç½®
  const bounds = threeCanvas.getBoundingClientRect();

  const x1 = event.clientX - bounds.left;
  const x2 = bounds.right - bounds.left;
  mouse.x = (x1 / x2) * 2 - 1;

  const y1 = event.clientY - bounds.top;
  const y2 = bounds.bottom - bounds.top;
  mouse.y = -(y1 / y2) * 2 + 1;

  // å°†å…¶æ”¾ç½®åœ¨æŒ‡å‘é¼ æ ‡çš„ç›¸æœºä¸Š
  raycaster.setFromCamera(mouse, camera);

  // æŠ•å°„å°„çº¿
  return raycaster.intersectObjects(ifcModels);
}
```

ğŸ‘“
æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°å¯ä»¥å‘å°„å°„çº¿å¹¶è¿”å›å®ƒæ‰€ç¢°æ’çš„ç‰©ä½“ï¼Œä½†æˆ‘ä»¬å¹¶æ²¡æœ‰å¯¹è¯¥ç‰©ä½“åšä»»ä½•äº‹æƒ…ã€‚è®©æˆ‘ä»¬åˆ›å»ºç¬¬äºŒä¸ªå‡½æ•°ï¼Œè·å–å°„çº¿å‡»ä¸­çš„é¢çš„ç´¢å¼•ï¼Œå¹¶åœ¨æ§åˆ¶å°ä¸­è®°å½•å®ƒæ‰€å±çš„å¯¹è±¡çš„å¿«é€’ IDã€‚

```js
function pick(event) {
  const found = cast(event)[0];
  if (found) {
    const index = found.faceIndex;
    const geometry = found.object.geometry;
    const ifc = ifcLoader.ifcManager;
    const id = ifc.getExpressId(geometry, index);
    console.log(id);
  }
}
```

<IfcAlert>
  Raycasteræ€»æ˜¯è¿”å›ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼Œå³ä½¿<i>raycaster.firstHitOnly = true;</i>
  ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°ç»„å°†åªåŒ…å«ä¸€ä¸ªå¯ä»¥ç”¨<i>[0]</i>æå–çš„å¯¹è±¡ã€‚
</IfcAlert>

æœ€åï¼Œå‰©ä¸‹çš„å°±æ˜¯å°†è¯¥å‡½æ•°ä¸ä¸€ä¸ªäº‹ä»¶ï¼ˆåœ¨æœ¬ä¾‹ä¸­æ˜¯ä¸€ä¸ªåŒå‡»ï¼‰è”ç³»èµ·æ¥ã€‚

```js
threeCanvas.ondblclick = pick;
```

å¦‚æœä½ åšå¯¹äº†ä¸€åˆ‡ï¼ŒåŒå‡»ä¸€ä¸ªé¡¹ç›®ï¼Œä½ ä¼šåœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°å®ƒçš„å¿«é€’ IDï¼ˆä½ å¯ä»¥é€šè¿‡æŒ‰ F12 æˆ–æ£€æŸ¥é¡µé¢æ¥è®¿é—®æ§åˆ¶å°ï¼‰ã€‚

<Scene
  link={"https://ifcjs.github.io/hello-world/examples/web-ifc-three/picking/"}
/>

## Next steps

ğŸ‰ğŸ‰ğŸ‰
ç¥è´ºä½ ! ä½ ç°åœ¨çŸ¥é“å¦‚ä½•é€šè¿‡ç‚¹å‡»ä¸€ä¸ªç‰©ä½“æ¥è·å¾—å®ƒçš„ IDã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ª ID åšå¾ˆå¤šäº‹æƒ…ã€‚

âœ¨
ç„¶è€Œï¼Œå¦‚æœç”¨æˆ·èƒ½ä»¥å›¾å½¢æ–¹å¼çœ‹åˆ°å¯¹è±¡è¢«é€‰ä¸­ï¼Œé‚£å°±æ›´å¥½äº†ã€‚ä¸ºæ­¤ï¼Œè®©æˆ‘ä»¬è¿›å…¥ä¸‹ä¸€ç‚¹ï¼Œåœ¨é‚£é‡Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•çªå‡ºæ˜¾ç¤ºå…ƒç´ ã€‚
